<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Panel</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
    />
    <style>
      body {
        display: flex;
        font-family: Arial, sans-serif;
      }
      .sidebar {
        width: 250px;
        background-color: #333;
        color: white;
        padding: 15px;
      }
      .sidebar h2 {
        text-align: center;
      }
      .sidebar ul {
        list-style: none;
        padding: 0;
      }
      .sidebar ul li {
        margin: 20px 0;
      }
      .sidebar ul li a {
        color: white;
        text-decoration: none;
      }
      .content {
        flex-grow: 1;
        padding: 20px;
      }
      .section {
        display: none;
      }
      .section.active {
        display: block;
      }
      i {
        cursor: pointer;
      }
      .product-form {
        margin-top: 20px;
        max-width: 400px;
      }
      .product-form input,
      .product-form textarea {
        width: 100%;
        padding: 10px;
        margin-bottom: 10px;
        border-radius: 5px;
        border: 1px solid #ccc;
      }
      .product-form button {
        padding: 10px;
        background-color: #28a745;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <div class="sidebar">
      <h2>Admin Panel</h2>
      <ul>
        <li><a href="#dashboard">Dashboard</a></li>
        <li><a href="#users">Users</a></li>
        <li><a href="#products">Products</a></li>
        <li><a href="#orders">Orders</a></li>
        <li><a href="#reports">Reports</a></li>
      </ul>
    </div>
    <div class="content">
      <div id="dashboard" class="section active">
        <h2>Dashboard</h2>
        <p>Welcome to the admin panel.</p>
      </div>
      <div id="users" class="section">
        <h2>Users</h2>
        <ul id="users-list"></ul>
      </div>
      <div id="products" class="section">
        <h2>Products</h2>
        <ul id="products-list"></ul>

        <div class="product-form">
          <h3>Add New Product</h3>
          <input
            type="text"
            id="product-name"
            placeholder="Product Name"
            required
          />
          <textarea
            id="product-description"
            placeholder="Product Description"
          ></textarea>
          <input
            type="number"
            id="product-price"
            placeholder="Product Price"
            required
          />
          <input
            type="number"
            id="product-stock"
            placeholder="Stock Quantity"
            required
          />
          <input
            type="text"
            id="product-link"
            placeholder="Product Link"
            required
          />
          <label for="options">Choose a Category:</label>
          <select id="options" name="options" required>
            <option value="bags">bags</option>
            <option value="beauty">beauty</option>
            <option value="clothing">clothing</option>
            <option value="Jewelry">Jewelry</option>
            <option value="shoes">shoes</option>
          </select>
          <br />
          <label for="options2">Choose a brand:</label>
          <select id="options2" name="options2" required>
            <option value="Gul Ahmed">Gul Ahmed</option>
            <option value="Khaadi">Khaadi</option>
            <option value="Junaid Jamshed">Junaid Jamshed</option>
            <option value="limelight">limelight</option>
            <option value="beechtree">beechtree</option>
          </select>
          <br />
          <button id="add-product-btn">Add Product</button>
        </div>
      </div>
      <div id="orders" class="section">
        <h2>Orders</h2>
        <ul id="orders-list"></ul>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const sections = document.querySelectorAll(".section");
        const navLinks = document.querySelectorAll(".sidebar ul li a");

        navLinks.forEach((link) => {
          link.addEventListener("click", function (event) {
            event.preventDefault();
            const targetSection = document.querySelector(
              this.getAttribute("href")
            );

            sections.forEach((section) => section.classList.remove("active"));
            targetSection.classList.add("active");

            if (this.getAttribute("href") === "#users") {
              fetchUsers();
            } else if (this.getAttribute("href") === "#products") {
              fetchProducts();
            } else if (this.getAttribute("href") === "#orders") {
              fetchOrders();
            }
          });
        });

        async function fetchUsers() {
          try {
            const response = await fetch("http://localhost:5000/api/users");
            if (!response.ok) {
              throw new Error("Network response was not ok");
            }
            const users = await response.json();
            displayUsers(users);
          } catch (error) {
            console.error("Failed to fetch users:", error);
          }
        }

        function displayUsers(users) {
          const usersList = document.getElementById("users-list");
          usersList.innerHTML = users
            .map(
              (user) =>
                `<li>${user.name} (${user.email}) <i class="fa-solid fa-trash" data-id="${user._id}"></i></li>`
            )
            .join("");

          document.querySelectorAll(".fa-trash").forEach((icon) => {
            icon.addEventListener("click", async function () {
              const userId = this.getAttribute("data-id");
              await deleteUser(userId);
              fetchUsers();
            });
          });
        }

        async function deleteUser(userId) {
          try {
            const response = await fetch(
              `http://localhost:5000/api/users/${userId}`,
              {
                method: "DELETE",
              }
            );
            if (!response.ok) {
              throw new Error(
                `Network response was not ok: ${response.statusText}`
              );
            }
          } catch (error) {
            console.error("Failed to delete user:", error);
          }
        }

        async function fetchProducts() {
          try {
            const response = await fetch("http://localhost:5000/api/products");
            if (!response.ok) {
              throw new Error("Network response was not ok");
            }
            const products = await response.json();
            displayProducts(products);
          } catch (error) {
            console.error("Failed to fetch products:", error);
          }
        }

        function displayProducts(products) {
          const productsList = document.getElementById("products-list");
          productsList.innerHTML = products
            .map(
              (product) =>
                `<li>${product.name} - PKR${product.price} (Stock: ${product.stock})</li>`
            )
            .join("");
        }

        async function fetchOrders() {
          try {
            const response = await fetch("http://localhost:5000/api/orders");
            if (!response.ok) {
              throw new Error("Network response was not ok");
            }
            const orders = await response.json();
            displayOrders(orders);
          } catch (error) {
            console.error("Failed to fetch orders:", error);
          }
        }

        function displayOrders(orders) {
          const ordersList = document.getElementById("orders-list");
          ordersList.innerHTML = orders
            .map(
              (order) =>
                `<li>Order ID: ${order._id}, Total: $${order.total}, Status: ${order.status}</li>`
            )
            .join("");
        }

        document
          .getElementById("add-product-btn")
          .addEventListener("click", async function () {
            const name = document.getElementById("product-name").value;
            const description = document.getElementById(
              "product-description"
            ).value;
            const price = document.getElementById("product-price").value;
            const stock = document.getElementById("product-stock").value;
            const link = document.getElementById("product-link").value;

            const productData = {
              name,
              description,
              price,
              stock,
              productlink: link,
              category: document.getElementById("options").value,
              brand: document.getElementById("options2").value,
            };

            try {
              const response = await fetch(
                "http://localhost:5000/api/products",
                {
                  method: "POST",
                  headers: {
                    "Content-Type": "application/json",
                  },
                  body: JSON.stringify(productData),
                }
              );

              if (!response.ok) {
                throw new Error("Failed to create product");
              }

              const newProduct = await response.json();
              fetchProducts(); // Refresh the product list
            } catch (error) {
              console.error("Failed to add product:", error);
            }
          });
      });
    </script>
  </body>
</html>
